<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz</title>

  <!-- Meta / theme -->
  <meta name="description" content="Pharm-let quiz runner with dark mode, streak flame, timer, and keyboard shortcuts." />
  <meta name="theme-color" content="#8b1e3f" />
  <link rel="icon" href="assets/icon.png" />

  <!-- CSP (no inline scripts) -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self';
             img-src 'self' data:;
             style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com;
             script-src 'self' https://cdn.tailwindcss.com;
             connect-src 'self';">

  <!-- CSS / Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <style>
    /* Small helper for visually-hidden live region */
    .sr-only {
      position: absolute; width: 1px; height: 1px;
      padding: 0; margin: -1px; overflow: hidden;
      clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
    }
    .sticky-head { position:sticky; top:0; z-index:50; backdrop-filter:saturate(1.2) blur(6px); background:color-mix(in oklab, var(--bg) 80%, transparent); }
    .mini-hint { font-size:.8rem; color:var(--muted); }
  </style>
</head>

<body class="bg-[var(--bg)] text-[var(--text)]">
  <!-- Skip to main content (accessibility) -->
  <a href="#app" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:z-50 focus:p-4 focus:bg-[var(--accent)] focus:text-white focus:rounded">Skip to quiz content</a>

  <header class="sticky-head border-b border-[var(--ring)]">
    <div class="max-w-3xl mx-auto px-4 py-2 sm:py-3">
      <!-- Row 1: Back link + Theme toggle -->
      <div class="flex items-center justify-between mb-2 sm:mb-0">
        <a href="index.html" class="quiz-link text-sm sm:text-base">‚Üê Back</a>
        <button id="theme-toggle" class="btn btn-ghost" type="button" aria-label="Toggle theme">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="1.5"/></svg>
          <span id="theme-label" class="hidden sm:inline">Dark</span>
        </button>
      </div>
      
      <!-- Row 2: Controls (wraps on mobile) -->
      <div class="flex flex-wrap items-center justify-between gap-2 sm:gap-3">
        <!-- Left side: Question count -->
        <div class="flex items-center gap-2">
          <span class="text-xs sm:text-sm hidden sm:inline" style="color:var(--muted)">Q:</span>
          <div id="qcount-group" class="segmented" role="group" aria-label="Question count">
            <a class="seg-link" data-limit="5"  href="#">5</a>
            <a class="seg-link" data-limit="10" href="#">10</a>
            <a class="seg-link" data-limit="20" href="#">20</a>
            <a class="seg-link" data-limit=""  href="#">All</a>
          </div>
        </div>
        
        <!-- Right side: Compact controls -->
        <div class="flex items-center gap-1 sm:gap-2">
          <button id="help-shortcuts" class="btn btn-ghost text-sm px-2 sm:px-3" type="button" aria-label="Help">?</button>
          <button id="share" class="btn btn-ghost text-sm px-2 sm:px-3" type="button" aria-label="Share">Share</button>

          <!-- Font size controls (hidden on mobile by default) -->
          <div class="font-size-controls hidden sm:flex">
            <button id="font-decrease" type="button" aria-label="Decrease font size">A-</button>
            <button id="font-increase" type="button" aria-label="Increase font size">A+</button>
          </div>

          <!-- High contrast toggle (text hidden on mobile) -->
          <button id="contrast-toggle" class="btn btn-ghost text-sm px-2 sm:px-3" type="button" aria-label="Toggle contrast">
            <span id="contrast-label" class="hidden sm:inline">Contrast</span>
            <span id="contrast-icon" class="sm:hidden">‚óê</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-3xl mx-auto p-6" id="app">
    <!-- Title + counters -->
    <header class="mb-4">
      <h1 id="quiz-title" class="text-2xl font-bold">Loading‚Ä¶</h1>

      <div class="flex justify-between items-center mt-2 text-sm" style="color: var(--muted);">
        <div>Question <span id="qnum">0</span>/<span id="qtotal">0</span></div>
        <div>Score: <span id="score">0</span></div>
      </div>

      <!-- Progress bar + flame + streak -->
      <div class="progress-bar-container" aria-label="Progress">
        <div id="progress-bar" class="progress-bar" style="width:0%;">
          <span id="fire-flame" class="fire-flame hidden" aria-hidden="true"></span>
          <span id="fire-count" class="hidden" aria-label="Current streak">√ó0</span>
        </div>
      </div>

      <!-- Progress mini-map (click to jump) -->
      <div id="nav-map" class="mt-2 flex flex-wrap gap-2 text-sm" aria-label="Question navigator"></div>
    </header>

    <!-- Question card -->
    <section id="question-card" class="quiz-card" aria-live="polite">
      <h2 id="prompt" class="font-semibold">Loading question‚Ä¶</h2>

      <!-- Multiple choice / TF container -->
      <div id="options" class="mt-3 space-y-2" role="radiogroup" aria-label="Answer choices"></div>

      <!-- Short answer -->
      <div id="short-wrap" class="mt-3 hidden">
        <label for="short-input" class="mini-hint">Short answer (not case sensitive)</label>
        <input id="short-input"
               class="w-full rounded-xl border border-slate-300 px-3 py-2"
               placeholder="Type your answer‚Ä¶" />
      </div>

      <!-- Explicit reveal + explanation (if present in JSON) -->
      <div id="explain" class="explain" aria-live="polite"></div>
      <div id="live" aria-live="polite" class="sr-only"></div>
    </section>

    <!-- Footer controls -->
    <footer class="mt-4 sm:mt-6 flex flex-col sm:flex-row flex-wrap items-stretch sm:items-center gap-2 sm:gap-3">
      <!-- Primary controls -->
      <div class="flex gap-2 sm:gap-3">
        <button id="prev" class="btn btn-gray flex-1 sm:flex-none text-sm" type="button" aria-label="Previous">‚Üê Prev</button>
        <button id="check" class="btn btn-blue flex-1 sm:flex-none text-sm" type="button" aria-label="Check">Check</button>
        <button id="next" class="btn btn-green hidden flex-1 sm:flex-none text-sm" type="button" aria-label="Next">Next ‚Üí</button>
      </div>

      <!-- Secondary controls (visible on mobile as row) -->
      <div class="flex gap-2 flex-wrap">
        <button id="mark" class="btn btn-ghost text-sm" type="button" aria-pressed="false" aria-label="Mark">
          <span id="mark-label">Mark</span>
        </button>

        <button id="hint-btn" class="btn btn-ghost text-sm" type="button" aria-label="Hint">
          <span id="hint-label">Hint</span>
        </button>

        <button id="reveal-solution" class="btn btn-ghost text-sm" type="button" aria-pressed="false" aria-label="Show solution">
          <span id="reveal-label">Show</span>
        </button>

        <!-- Timer -->
        <button id="timer-toggle" class="btn btn-ghost text-sm" type="button" aria-pressed="false" aria-label="Timer">
          <span id="timer-label">Timer</span>
        </button>
        <span id="timer-readout" class="text-xs sm:text-sm flex items-center" style="color:var(--muted)">00:00</span>

        <button id="restart" class="btn btn-ghost text-sm" type="button" aria-label="Restart">Restart</button>
      </div>

      <span class="mini-hint text-xs mt-2 hidden sm:inline">üí° Use 1-9 to pick, Enter to check, ? for help</span>
    </footer>

    <!-- Results -->
    <section id="results" class="hidden text-center mt-8" aria-live="polite">
      <h2 class="text-3xl font-bold mb-2">Quiz Complete!</h2>
      <p>Your final score is: <span id="final-score" class="font-bold" style="color:var(--accent)"></span></p>
  <div id="celebrate" class="text-4xl mt-4 hidden" aria-hidden="true"></div>
      <!-- summary + review button are injected by JS -->
    </section>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcuts-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50" style="display:none;">
      <div class="card max-w-2xl w-full mx-4 p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold">Keyboard Shortcuts</h2>
          <button id="close-shortcuts" class="btn btn-ghost text-2xl" aria-label="Close">√ó</button>
        </div>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-semibold mb-3">Navigation</h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span>Next question</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">‚Üí or N</kbd></div>
              <div class="flex justify-between"><span>Previous question</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">‚Üê or P</kbd></div>
              <div class="flex justify-between"><span>Check answer</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">Enter or C</kbd></div>
              <div class="flex justify-between"><span>Restart quiz</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">R</kbd></div>
            </div>
          </div>
          
          <div>
            <h3 class="font-semibold mb-3">Quiz Controls</h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span>Select option 1-9</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">1-9</kbd></div>
              <div class="flex justify-between"><span>Show hint</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">H</kbd></div>
              <div class="flex justify-between"><span>Reveal solution</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">S</kbd></div>
              <div class="flex justify-between"><span>Mark for review</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">M</kbd></div>
              <div class="flex justify-between"><span>Toggle timer</span><kbd class="px-2 py-1 rounded" style="background:var(--ring)">T</kbd></div>
            </div>
          </div>
        </div>
        
        <div class="mt-6 pt-4 border-t border-[var(--ring)] text-sm" style="color:var(--muted)">
          <p>üí° Tip: Press <kbd class="px-2 py-1 rounded" style="background:var(--ring)">?</kbd> anytime to see this help menu.</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts (no inline JS; CSP-safe) -->
  <script src="assets/js/quizPage.js"></script>
  <script type="module" src="assets/js/quizEngine.js"></script>
</body>
</html>